# DigitalCalc - Распределенный калькулятор выражений

DigitalCalc - это распределенная система для вычисления математических выражений, состоящая из оркестратора и агентов. Оркестратор принимает выражения от пользователей, распределяет задачи между агентами и возвращает результаты. Агенты выполняют вычисления и отправляют результаты обратно в оркестратор.

## Основные компоненты

1. **Оркестратор**:
   - Принимает выражения от пользователей.
   - Распределяет задачи между агентами.
   - Хранит состояние выражений и результатов.
   - Возвращает результаты пользователям.

2. **Агенты**:
   - Получают задачи от оркестратора.
   - Вычисляют выражения.
   - Отправляют результаты обратно в оркестратор.

## Зависимости

- **Go** (версия 1.20 или выше)
- **Zap** (для логирования)
- **HTTP** (для взаимодействия между компонентами)

## Установка и запуск

### 1. Установка зависимостей

Убедитесь, что у вас установлен Go. Затем установите необходимые зависимости:

```bash
go mod tidy
```

### 2. Запуск оркестратора

Для запуска оркестратора выполните следующую команду:

```bash
go run cmd/orchestrator/main.go
```

Оркестратор будет доступен на порту `8080`.

### 3. Запуск агентов

Для запуска агентов выполните следующую команду:

```bash
go run cmd/agent/main.go
```

Вы можете запустить несколько агентов, указав переменную окружения `COMPUTING_POWER` для управления количеством рабочих потоков:

```bash
COMPUTING_POWER=4 go run cmd/agent/main.go
```

## API

### 1. Отправка выражения на вычисление

**Запрос:**

```http
POST /api/v1/calculate
Content-Type: application/json

{
  "expression": "2 + 2 * 2"
}
```

**Ответ:**

```json
{
  "id": "exp-1234567890"
}
```

### 2. Получение списка выражений

**Запрос:**

```http
GET /api/v1/expressions
```

**Ответ:**

```json
{
  "expressions": [
    {
      "id": "exp-1234567890",
      "expression": "2 + 2 * 2",
      "status": "completed",
      "result": "6"
    }
  ]
}
```

### 3. Получение результата выражения по ID

**Запрос:**

```http
GET /api/v1/expressions/{id}
```

**Ответ:**

```json
{
  "expression": {
    "id": "exp-1234567890",
    "expression": "2 + 2 * 2",
    "status": "completed",
    "result": "6"
  }
}
```

### 4. Получение задачи для агента

**Запрос:**

```http
GET /internal/task
```

**Ответ:**

```json
{
  "id": "exp-1234567890",
  "expression": "2 + 2 * 2"
}
```

### 5. Отправка результата задачи

**Запрос:**

```http
POST /internal/task/result
Content-Type: application/json

{
  "id": "exp-1234567890",
  "result": 6
}
```

**Ответ:**

```http
HTTP/1.1 200 OK
```

## Тестирование

Для запуска тестов выполните следующую команду:

```bash
go test ./...
```

## Логирование

Логирование осуществляется с использованием библиотеки **Zap**. Логи записываются в стандартный вывод и включают информацию о запросах, ошибках и результатах вычислений.

## Примеры использования

### Пример 1: Вычисление простого выражения

1. Отправьте выражение на вычисление:

   ```bash
   curl -X POST http://localhost:8080/api/v1/calculate -H "Content-Type: application/json" -d '{"expression": "2 + 2 * 2"}'
   ```

2. Получите результат:

   ```bash
   curl http://localhost:8080/api/v1/expressions/exp-1234567890
   ```

### Пример 2: Запуск нескольких агентов

1. Запустите оркестратор:

   ```bash
   go run cmd/orchestrator/main.go
   ```

2. Запустите несколько агентов:

   ```bash
   COMPUTING_POWER=4 go run cmd/agent/main.go
   ```

3. Отправьте несколько выражений на вычисление и наблюдайте за их обработкой.

## Лицензия

Этот проект распространяется под лицензией MIT. Подробности см. в файле [LICENSE](LICENSE).

---

Этот README предоставляет общее описание проекта и инструкции по его запуску. Для более детальной информации о реализации и архитектуре, пожалуйста, обратитесь к исходному коду.
